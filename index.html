<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Teste Cintura/Quadril ‚Äì +Maravilhosa</title>
  <meta name="description" content="Fa√ßa o teste de rela√ß√£o cintura/quadril, descubra seu risco metab√≥lico e receba conte√∫dos personalizados."/>
  <style>
    :root{
      --rose-50:#fff7f9; --rose-100:#ffe9f0; --rose-200:#ffd3df; --rose-300:#ffb1c5; --rose-400:#ff8fb0; --rose-500:#ff6b97;
      --ink-900:#111827; --ink-700:#2b2e38; --ink-500:#4b4f5c; --ink-300:#7a7f91; --ok:#10b981; --warn:#f59e0b; --bad:#ef4444;
      --card-shadow:0 10px 25px rgba(43,46,56,.08);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--ink-700);background:linear-gradient(160deg,var(--rose-50),#fff)}
    .wrap{max-width:980px;margin:auto;padding:24px}
    .hero{background:linear-gradient(135deg,var(--rose-100),#e8e7ff);border:2px solid var(--rose-200);border-radius:24px;padding:28px;box-shadow:var(--card-shadow)}
    h1{margin:0 0 8px;font-size:clamp(24px,3vw,36px)}
    p.lead{margin:0;font-size:clamp(14px,2.4vw,18px);color:var(--ink-500)}
    .grid{display:grid;gap:18px}
    @media (min-width:880px){ .grid-2{grid-template-columns:1fr 1fr} }
    .card{background:#fff;border:1px solid #f3f3f7;border-radius:20px;padding:20px;box-shadow:var(--card-shadow)}
    label{display:block;font-weight:600;margin:10px 0 6px}
    input,select,button{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #e7e7ef;font-size:16px}
    input:focus,select:focus{outline:3px solid var(--rose-200);border-color:var(--rose-400)}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:680px){.row-2{grid-template-columns:1fr 1fr}}
    .btn{background:var(--rose-500);color:#fff;font-weight:700;border:none;cursor:pointer;transition:.2s}
    .btn:hover{filter:brightness(.95);transform:translateY(-1px)}
    .btn.secondary{background:#fff;color:var(--ink-700);border:1px solid #e7e7ef}
    .muted{font-size:13px;color:var(--ink-300)}
    .hide{display:none}
    .pill{display:inline-flex;gap:8px;align-items:center;background:#fff;border:1px solid #f0e0ea;padding:8px 12px;border-radius:999px}
    .tag{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700}
    .tag.ok{background:#ecfdf5;color:var(--ok)}
    .tag.warn{background:#fffbeb;color:var(--warn)}
    .tag.bad{background:#fef2f2;color:var(--bad)}
    .result-box{border-radius:16px;padding:16px;border:1px dashed #ececf4;background:#fcfcff}
    .tips{font-size:14px;color:var(--ink-500)}
    .hr{height:1px;background:linear-gradient(90deg,transparent,#eee,transparent);margin:18px 0}
    .checkbox{display:flex;gap:10px;align-items:flex-start}
    .checkbox input{width:auto;margin-top:3px}
    .footer{margin:28px 0 8px;text-align:center;color:var(--ink-300);font-size:12px}
    .toast{position:fixed;right:16px;bottom:16px;background:#111827;color:#fff;padding:12px 14px;border-radius:12px;opacity:0;pointer-events:none;transition:opacity .2s,transform .2s;transform:translateY(6px)}
    .toast.show{opacity:1;pointer-events:auto;transform:translateY(0)}
  </style>
</head>
<body>
  <div class="wrap">
    <section class="hero grid grid-2" aria-labelledby="title">
      <div>
        <h1 id="title">Teste Cintura/Quadril (+Maravilhosa)</h1>
        <p class="lead">Descubra como est√° o seu <strong>risco de doen√ßas card√≠acas, AVC e gordura no f√≠gado</strong> com um teste simples que voc√™ pode fazer em casa. Preencha seus dados para liberar o teste e receber orienta√ß√µes personalizadas.</p>
        <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
          <span class="pill">‚öñÔ∏è RCQ ‚Äì Cintura/Quadril</span>
          <span class="pill">üì≤ Mobile-friendly</span>
          <span class="pill">üóÇÔ∏è Exporta CSV</span>
          <a class="btn secondary" href="https://script.google.com/macros/s/AKfycbym4vgfn6HGvTmgOZ27OlWZe-z2ucZfOIkwolB85XAaVqccxk9YyxBkMwQmcohzIGPd/exec" target="_blank" rel="noopener">üîå Testar conex√£o</a>
        </div>
      </div>

      <div class="card">
        <h2 style="margin:0 0 10px">1) Seus dados</h2>
        <form id="leadForm" autocomplete="on" novalidate>
          <div class="row row-2">
            <div>
              <label for="nome">Nome*</label>
              <input id="nome" name="nome" required placeholder="Seu nome" />
            </div>
            <div>
              <label for="email">Email*</label>
              <input id="email" name="email" type="email" required placeholder="voce@email.com" />
            </div>
            <div>
              <label for="whats">WhatsApp</label>
              <input id="whats" name="whats" inputmode="tel" placeholder="(DDD) 9 9999-9999" />
            </div>
            <div>
              <label for="idade">Idade</label>
              <input id="idade" name="idade" type="number" min="10" max="100" placeholder="Ex.: 35" />
            </div>
            <div>
              <label for="cidade">Cidade</label>
              <input id="cidade" name="cidade" placeholder="Cidade/Estado ou Pa√≠s" />
            </div>
            <div>
              <label for="sexoLead">Sexo*</label>
              <select id="sexoLead" name="sexoLead" required>
                <option value="">Selecione‚Ä¶</option>
                <option value="F">Mulher</option>
                <option value="M">Homem</option>
              </select>
            </div>
          </div>
          <div class="checkbox" style="margin:10px 0 8px">
            <input id="consent" type="checkbox" required />
            <label for="consent" class="muted">Concordo em receber conte√∫dos e comunica√ß√µes sobre sa√∫de, nutri√ß√£o e o programa +Maravilhosa. Posso cancelar a qualquer momento.</label>
          </div>
          <button id="btnLiberar" type="submit" class="btn">Liberar teste</button>
          <div class="muted" style="margin-top:8px">Seus dados s√£o protegidos (LGPD). Usamos apenas para contato e entrega do seu resultado.</div>
        </form>

        <div id="afterLead" class="hide" aria-live="polite" style="margin-top:14px">
          <span class="tag ok">‚úîÔ∏è Dados recebidos</span>
          <button class="btn secondary" id="dlCsv" style="margin-left:8px">Exportar CSV</button>
          <button class="btn secondary" id="copyCsv" style="margin-left:8px">Copiar CSV</button>
        </div>
      </div>
    </section>

    <section id="testCard" class="card hide" style="margin-top:18px">
      <h2 style="margin:0 0 6px">2) Fa√ßa o teste de Cintura/Quadril</h2>
      <p class="muted" style="margin:0 0 12px">
        Me√ßa a <strong>cintura</strong> (parte mais fina do tronco; na d√∫vida, ponto m√©dio entre a √∫ltima costela e o osso do quadril) e o <strong>quadril</strong> (parte mais larga dos gl√∫teos).
        Mantenha os p√©s na largura dos ombros, n√£o prenda a respira√ß√£o e n√£o aperte a fita.
      </p>
      <form id="whrForm" novalidate>
        <div class="row row-2">
          <div>
            <label for="sexo">Sexo</label>
            <select id="sexo" name="sexo" required>
              <option value="">Selecione‚Ä¶</option>
              <option value="F">Mulher</option>
              <option value="M">Homem</option>
            </select>
          </div>
          <div>
            <label for="cintura">Cintura (cm)</label>
            <input id="cintura" name="cintura" type="number" min="30" max="200" step="0.1" placeholder="Ex.: 75.0" required />
          </div>
          <div>
            <label for="quadril">Quadril (cm)</label>
            <input id="quadril" name="quadril" type="number" min="40" max="250" step="0.1" placeholder="Ex.: 95.0" required />
          </div>
        </div>
        <button class="btn" type="submit" style="margin-top:10px">Calcular</button>
      </form>

      <div id="result" class="result-box hide" style="margin-top:14px">
        <div id="ratioLine" style="font-size:18px;font-weight:800">RCQ: ‚Äì</div>
        <div id="statusLine" style="margin-top:6px"></div>
        <ul class="tips">
          <li>Mulher: ideal &lt; <strong>0,80</strong>. Homem: ideal &lt; <strong>0,95</strong>.</li>
          <li>Resultado alto indica maior risco cardiometab√≥lico mesmo com IMC normal.</li>
          <li>Repita a medida 2√ó e use a m√©dia para mais precis√£o.</li>
        </ul>
      </div>
    </section>

    <section class="card" style="margin-top:18px">
      <h3 style="margin:0 0 8px">Como interpretar</h3>
      <div class="row row-2">
        <div>
          <p><strong>Mulheres:</strong> RCQ &lt; 0,80 ‚Üí <span class="tag ok">ideal</span>. RCQ ‚â• 0,80 ‚Üí <span class="tag bad">aten√ß√£o</span>.</p>
          <p><strong>Homens:</strong> RCQ &lt; 0,95 ‚Üí <span class="tag ok">ideal</span>. RCQ ‚â• 0,95 ‚Üí <span class="tag bad">aten√ß√£o</span>.</p>
        </div>
        <div>
          <p class="muted">Mesmo que o peso esteja ‚Äúok‚Äù, RCQ elevado sugere gordura abdominal. Foque em refei√ß√£o completa com prote√≠na adequada, fibras em base vegetal e bons h√°bitos de sono/estresse.</p>
        </div>
      </div>
    </section>

    <div class="footer">¬© +Maravilhosa ‚Ä¢ Pronto para GitHub Pages ‚Ä¢ LGPD: dados usados apenas para contato e entrega do resultado.</div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite">Status</div>

  <script>
    // üîó Webhook do seu Apps Script (produ√ß√£o /exec)
    const WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbym4vgfn6HGvTmgOZ27OlWZe-z2ucZfOIkwolB85XAaVqccxk9YyxBkMwQmcohzIGPd/exec";

    // ===== Helpers UI =====
    function showToast(msg){
      const t = document.getElementById('toast');
      t.textContent = msg || "Ok";
      t.classList.add('show');
      setTimeout(()=>t.classList.remove('show'), 1800);
    }

    // ===== Persist√™ncia local (evita ‚Äúzerar‚Äù campos) =====
    const STORE_KEY = "mm_whr_leads_v1";
    const leadFields = ["nome","email","whats","idade","cidade","sexoLead","consent"];
    function saveLeadDraft(){
      const data = {};
      leadFields.forEach(id=>{
        const el = document.getElementById(id);
        if(!el) return;
        data[id] = el.type === 'checkbox' ? el.checked : el.value;
      });
      localStorage.setItem(STORE_KEY+"_draft", JSON.stringify(data));
    }
    function loadLeadDraft(){
      const raw = localStorage.getItem(STORE_KEY+"_draft");
      if(!raw) return;
      try{
        const data = JSON.parse(raw);
        leadFields.forEach(id=>{
          const el = document.getElementById(id);
          if(!el || !(id in data)) return;
          if(el.type === 'checkbox') el.checked = !!data[id];
          else el.value = data[id] || "";
        });
      }catch(_) {}
    }
    function clearLeadDraft(){ localStorage.removeItem(STORE_KEY+"_draft"); }

    // ===== Envio ao webhook (form-urlencoded) =====
    async function postWebhook(doc){
      if(!WEBHOOK_URL) return {ok:false, msg:'WEBHOOK_URL vazio'};
      try{
        const body = new URLSearchParams();
        Object.entries(doc||{}).forEach(([k,v])=> body.append(k, v==null? '' : String(v)));
        await fetch(WEBHOOK_URL, {
          method:'POST',
          body,
          mode:'no-cors',
          keepalive:true
        });
        return {ok:true};
      }catch(err){
        console.warn('Falha no webhook:', err);
        return {ok:false, error:String(err)};
      }
    }

    // ===== Lead form =====
    const leadForm = document.getElementById('leadForm');
    const afterLead = document.getElementById('afterLead');
    const testCard = document.getElementById('testCard');

    // Auto-save conforme digita
    leadForm.addEventListener('input', saveLeadDraft);
    // Rep√µe dados salvos
    loadLeadDraft();

    leadForm.addEventListener('submit', async (e)=>{
      e.preventDefault();

      // Valida√ß√£o m√≠nima manual
      const nome = document.getElementById('nome').value.trim();
      const email = document.getElementById('email').value.trim();
      const sexoLead = document.getElementById('sexoLead').value;
      const consent = document.getElementById('consent').checked;
      if(!nome || !email || !sexoLead || !consent){
        showToast('Preencha nome, e-mail, sexo e aceite o consentimento.');
        return;
      }

      // Monta objeto e salva localmente
      const doc = {
        nome,
        email,
        whats: document.getElementById('whats').value.trim(),
        idade: document.getElementById('idade').value.trim(),
        cidade: document.getElementById('cidade').value.trim(),
        sexo: sexoLead,
        ts: new Date().toISOString()
      };

      // UI: libera o teste imediatamente (sem esperar rede)
      afterLead.classList.remove('hide');
      testCard.classList.remove('hide');
      document.getElementById('sexo').value = sexoLead;
      testCard.scrollIntoView({behavior:'smooth'});
      showToast('Teste liberado!');

      // Envia ao Sheets (ass√≠ncrono) + limpa rascunho
      postWebhook(doc);
      clearLeadDraft();
    });

    // Exporta√ß√µes (CSV local)
    function toCsv(rows){
      const header = Object.keys(rows[0] || {nome:"", email:"", whats:"", idade:"", cidade:"", sexo:"", ts:""});
      const escape = v => (""+v).replaceAll('"','""');
      const lines = [header.join(",")].concat(rows.map(r => header.map(k => `"${escape(r[k] ?? "")}"`).join(",")));
      return lines.join("\n");
    }
    document.getElementById('dlCsv').addEventListener('click', ()=>{
      const raw = localStorage.getItem(STORE_KEY);
      const leads = raw ? JSON.parse(raw) : [];
      if(!leads.length){ showToast('Sem dados para exportar.'); return; }
      const blob = new Blob([toCsv(leads)], {type:"text/csv;charset=utf-8;"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = 'leads_teste_cintura_quadril.csv'; a.click();
      URL.revokeObjectURL(url);
    });
    document.getElementById('copyCsv').addEventListener('click', async ()=>{
      const raw = localStorage.getItem(STORE_KEY);
      const leads = raw ? JSON.parse(raw) : [];
      if(!leads.length){ showToast('Sem dados para copiar.'); return; }
      try{
        await navigator.clipboard.writeText(toCsv(leads));
        showToast('CSV copiado!');
      }catch{ showToast('N√£o foi poss√≠vel copiar.'); }
    });

    // ===== Teste RCQ =====
    const whrForm = document.getElementById('whrForm');
    const resultBox = document.getElementById('result');
    const ratioLine = document.getElementById('ratioLine');
    const statusLine = document.getElementById('statusLine');

    function fmt(x){ return (Math.round(Number(x)*100)/100).toFixed(2); }
    function classify(sexo, rcq){
      if(sexo === 'F'){
        return rcq < 0.80 ? {tag:'ok', label:'Ideal', msg:'Parab√©ns! Sua rela√ß√£o cintura/quadril est√° em faixa ideal (mulheres < 0,80).'}
                          : {tag:'bad', label:'Aten√ß√£o', msg:'Sua rela√ß√£o cintura/quadril est√° acima do ideal (mulheres ‚â• 0,80).'};
      } else if(sexo === 'M'){
        return rcq < 0.95 ? {tag:'ok', label:'Ideal', msg:'√ìtimo! Sua rela√ß√£o cintura/quadril est√° em faixa ideal (homens < 0,95).'}
                          : {tag:'bad', label:'Aten√ß√£o', msg:'Sua rela√ß√£o cintura/quadril est√° acima do ideal (homens ‚â• 0,95).'};
      }
      return {tag:'warn', label:'Preencha o sexo', msg:'Selecione seu sexo para interpretar corretamente.'}
    }

    whrForm.addEventListener('submit', async (e)=>{
      e.preventDefault();

      const sexo = document.getElementById('sexo').value;
      const c = parseFloat(document.getElementById('cintura').value);
      const q = parseFloat(document.getElementById('quadril').value);
      if(!sexo || !c || !q || q<=0){ showToast('Preencha sexo, cintura e quadril.'); return; }

      const rcq = c / q;
      const klass = classify(sexo, rcq);
      resultBox.classList.remove('hide');
      ratioLine.textContent = `RCQ: ${fmt(rcq)}`;
      statusLine.innerHTML = `<span class="tag ${klass.tag}">${klass.label}</span> <span style="margin-left:8px">${klass.msg}</span>`;
      resultBox.scrollIntoView({behavior:'smooth'});
      showToast('Resultado calculado!');

      // Envia resultado ao Sheets (ass√≠ncrono)
      const draftRaw = localStorage.getItem(STORE_KEY+"_draft");
      const draft = draftRaw ? JSON.parse(draftRaw) : {};
      const payloadRes = {
        nome: (draft.nome || '').trim(),
        email: (draft.email || '').trim(),
        sexo,
        cintura: c,
        quadril: q,
        rcq: Number(rcq.toFixed(2)),
        ts: new Date().toISOString()
      };
      postWebhook(payloadRes);
    });

    // Evita que algum erro silencioso quebre a UI
    window.addEventListener('error', ()=> showToast('Ops! Houve um erro no site.'));
  </script>
</body>
</html>
